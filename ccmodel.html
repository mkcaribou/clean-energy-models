<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clean Cooking ROI Analysis</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #fff; font-size: 15px; }
        input[type="range"] { 
            width: 100%; 
            height: 5px; 
            background: #e5e7eb;
            border-radius: 3px; 
            outline: none; 
            -webkit-appearance: none; 
        }
        input[type="range"]::-webkit-slider-thumb { 
            -webkit-appearance: none; 
            width: 20px; 
            height: 20px; 
            background: #fff;
            border: 3px solid #1e1e1e;
            border-radius: 50%; 
            cursor: pointer; 
        }
        input[type="range"]::-moz-range-thumb { 
            width: 20px; 
            height: 20px; 
            background: #fff;
            border: 3px solid #1e1e1e;
            border-radius: 50%; 
            cursor: pointer; 
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        function StoveStackingWidget() {
          // Payment method
          const [paymentMethod, setPaymentMethod] = useState('upfront');
          
          // Financing parameters
          const [depositPercent, setDepositPercent] = useState(20);
          const [loanTermYears, setLoanTermYears] = useState(2);
          const [annualInterestRate, setAnnualInterestRate] = useState(30);
          
          // PAYG parameters
          const [paygTermYears, setPaygTermYears] = useState(2);
          const [paygPremiumPercent, setPaygPremiumPercent] = useState(70);
          
          // Household income for affordability
          const [monthlyHouseholdIncome, setMonthlyHouseholdIncome] = useState(80);
          
          // Baseline parameters
          const [baselineFuelCost, setBaselineFuelCost] = useState(140);
          const [stacking, setStacking] = useState(50);
          const [timeReallocationPct, setTimeReallocationPct] = useState(0);
          const [wageRate, setWageRate] = useState(0.27);
          const [baselineFuelCollection, setBaselineFuelCollection] = useState(1.5);
          const [baselineCookingTime, setBaselineCookingTime] = useState(4.8);
          
          // Technology capital costs
          const [icsCapitalBase, setIcsCapitalBase] = useState(25);
          const [lpgCapitalBase, setLpgCapitalBase] = useState(50);
          const [solarCapitalBase, setSolarCapitalBase] = useState(650);
          
          // LPG fuel cost
          const [lpgAnnualFuelCost, setLpgAnnualFuelCost] = useState(73);
          
          const technologies = {
            ics: {
              name: "Improved Cookstoves",
              capitalCost: icsCapitalBase,
              lifespan: 5,
              fuelType: 'fraction',
              fuelReduction: 0.35,
              fuelCollectionReduction: 0.35,
              cookingTimeReduction: 0.15,
              pm25Reduction: 0.40,
              dalys: 0.02,
              evidenceStrength: "High (cost/efficiency); Low (health)",
              description: "Efficient, durable biomass stove (e.g., Jikokoa) with improved combustion chamber that reduces fuel use by 35% vs. traditional 3-stone fire."
            },
            lpg: {
              name: "LPG",
              capitalCost: lpgCapitalBase,
              lifespan: 10,
              fuelType: 'absolute',
              newFuelCost: lpgAnnualFuelCost,
              fuelCollectionReduction: 0.70,
              cookingTimeReduction: 0.25,
              pm25Reduction: 0.85,
              dalys: 0.13,
              evidenceStrength: "Medium",
              description: "Single-burner LPG stove with 6kg cylinder. Clean-burning gas eliminates smoke and reduces cooking time. Supply chains need to be reliable."
            },
            solar: {
              name: "Solar E-Cooking",
              capitalCost: solarCapitalBase,
              lifespan: 7,
              fuelType: 'absolute',
              newFuelCost: 0,
              fuelCollectionReduction: 0.80,
              cookingTimeReduction: 0.25,
              pm25Reduction: 0.95,
              dalys: 0.138,
              evidenceStrength: "Medium (emerging technology)",
              description: "Solar Home System (4-panel, ~200W) with Electric Pressure Cooker. Zero emissions, fast cooking, but requires reliable supply chain."
            }
          };
          
          // Calculate financing details for a given technology
          const calculateFinancingDetails = (tech) => {
            const baseCost = technologies[tech].capitalCost;
            const lifespan = technologies[tech].lifespan;
            
            if (paymentMethod === 'upfront') {
              return {
                totalCost: baseCost,
                depositRequired: baseCost,
                monthlyPayment: 0,
                totalInterest: 0,
                effectiveAnnualCost: baseCost / lifespan,
                description: 'Full payment upfront'
              };
            }
            
            if (paymentMethod === 'financing') {
              const deposit = baseCost * (depositPercent / 100);
              const principal = baseCost - deposit;
              const monthlyRate = annualInterestRate / 100 / 12;
              const numPayments = loanTermYears * 12;
              
              let monthlyPayment = 0;
              if (monthlyRate > 0 && numPayments > 0) {
                monthlyPayment = principal * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / (Math.pow(1 + monthlyRate, numPayments) - 1);
              } else {
                monthlyPayment = principal / numPayments;
              }
              
              const totalPaid = deposit + (monthlyPayment * numPayments);
              const totalInterest = totalPaid - baseCost;
              
              return {
                totalCost: totalPaid,
                depositRequired: deposit,
                monthlyPayment: monthlyPayment,
                totalInterest: totalInterest,
                effectiveAnnualCost: totalPaid / lifespan,
                description: `${depositPercent}% deposit + ${loanTermYears}-year loan at ${annualInterestRate}% APR`
              };
            }
            
            // PAYG (lease-to-own)
            const totalCost = baseCost * (1 + paygPremiumPercent / 100);
            const monthlyPayment = totalCost / (paygTermYears * 12);
            return {
              totalCost: totalCost,
              depositRequired: 0,
              monthlyPayment: monthlyPayment,
              totalInterest: totalCost - baseCost,
              effectiveAnnualCost: totalCost / lifespan,
              description: `Lease-to-own over ${paygTermYears} years, ${paygPremiumPercent}% total premium`
            };
          };
          
          // Affordability check
          const checkAffordability = (monthlyPayment, depositRequired, techName, totalCost) => {
            const issues = [];
            
            if (paymentMethod === 'upfront') {
              const monthsOfIncome = totalCost / monthlyHouseholdIncome;
              if (monthsOfIncome > 3) {
                issues.push({ 
                  severity: 'error', 
                  message: `${techName}: Upfront cost ($${Math.round(totalCost)}) exceeds 3 months income. Requires subsidies or financing.` 
                });
              } else if (monthsOfIncome > 1.5) {
                issues.push({ 
                  severity: 'warning', 
                  message: `${techName}: Upfront cost ($${Math.round(totalCost)}) exceeds 1.5 months income. Major access barrier.` 
                });
              }
            } else {
              const paymentToIncomeRatio = (monthlyPayment / monthlyHouseholdIncome) * 100;
              
              if (paymentToIncomeRatio > 15) {
                issues.push({ 
                  severity: 'error', 
                  message: `${techName}: Monthly payment (${paymentToIncomeRatio.toFixed(0)}% of income) exceeds threshold of 15%. High default risk.` 
                });
              } else if (paymentToIncomeRatio > 10) {
                issues.push({ 
                  severity: 'warning', 
                  message: `${techName}: Monthly payment (${paymentToIncomeRatio.toFixed(0)}% of income) is moderately high. May strain household budget.` 
                });
              }
              
              if (paymentMethod === 'financing' && depositRequired > 0) {
                if (depositRequired > monthlyHouseholdIncome * 1.5) {
                  issues.push({ 
                    severity: 'error', 
                    message: `${techName}: Deposit ($${Math.round(depositRequired)}) exceeds 1.5 months income. Major access barrier.` 
                  });
                } else if (depositRequired > monthlyHouseholdIncome * 0.5) {
                  issues.push({ 
                    severity: 'warning', 
                    message: `${techName}: Deposit ($${Math.round(depositRequired)}) exceeds half a month's income. May require subsidies or financing.` 
                  });
                }
              }
            }
            
            return { issues };
          };
          
          const icsFinancing = calculateFinancingDetails('ics');
          const lpgFinancing = calculateFinancingDetails('lpg');
          const solarFinancing = calculateFinancingDetails('solar');
          
          const icsAffordability = checkAffordability(icsFinancing.monthlyPayment, icsFinancing.depositRequired, 'ICS', icsFinancing.totalCost);
          const lpgAffordability = checkAffordability(lpgFinancing.monthlyPayment, lpgFinancing.depositRequired, 'LPG', lpgFinancing.totalCost);
          const solarAffordability = checkAffordability(solarFinancing.monthlyPayment, solarFinancing.depositRequired, 'Solar', solarFinancing.totalCost);
          
          const allAffordabilityIssues = [
            ...icsAffordability.issues,
            ...lpgAffordability.issues,
            ...solarAffordability.issues
          ];
          
          const icsCapital = icsFinancing.effectiveAnnualCost;
          const lpgCapital = lpgFinancing.effectiveAnnualCost;
          const solarCapital = solarFinancing.effectiveAnnualCost;
          
          const icsTotalCapital = icsFinancing.totalCost;
          const lpgTotalCapital = lpgFinancing.totalCost;
          const solarTotalCapital = solarFinancing.totalCost;

          const calculateFuelCost = (tech) => {
            const spec = technologies[tech];
            const modernUse = (100 - stacking) / 100;
            const traditionalUse = stacking / 100;
            
            if (spec.fuelType === 'fraction') {
              const reducedFuelCost = baselineFuelCost * (1 - spec.fuelReduction);
              return (modernUse * reducedFuelCost) + (traditionalUse * baselineFuelCost);
            } else {
              return (modernUse * spec.newFuelCost) + (traditionalUse * baselineFuelCost);
            }
          };

          const calculateTimeValue = (collectionReduction, cookingReduction) => {
            const adoptionRate = (100 - stacking) / 100;
            const collectionSaved = baselineFuelCollection * collectionReduction * adoptionRate;
            const cookingSaved = baselineCookingTime * cookingReduction * adoptionRate;
            const totalDailyHoursSaved = collectionSaved + cookingSaved;
            const annualHoursSaved = totalDailyHoursSaved * 365;
            const reallocatedHours = annualHoursSaved * (timeReallocationPct / 100);
            return reallocatedHours * wageRate;
          };

          const calculateTotalHoursSaved = (collectionReduction, cookingReduction) => {
            const adoptionRate = (100 - stacking) / 100;
            const collectionSaved = baselineFuelCollection * collectionReduction * adoptionRate;
            const cookingSaved = baselineCookingTime * cookingReduction * adoptionRate;
            return (collectionSaved + cookingSaved) * 365;
          };

          const icsFuelCost = calculateFuelCost('ics');
          const lpgFuelCost = calculateFuelCost('lpg');
          const solarFuelCost = calculateFuelCost('solar');
          
          const icsTimeValue = calculateTimeValue(technologies.ics.fuelCollectionReduction, technologies.ics.cookingTimeReduction);
          const lpgTimeValue = calculateTimeValue(technologies.lpg.fuelCollectionReduction, technologies.lpg.cookingTimeReduction);
          const solarTimeValue = calculateTimeValue(technologies.solar.fuelCollectionReduction, technologies.solar.cookingTimeReduction);
          
          const icsTotalHours = calculateTotalHoursSaved(technologies.ics.fuelCollectionReduction, technologies.ics.cookingTimeReduction);
          const lpgTotalHours = calculateTotalHoursSaved(technologies.lpg.fuelCollectionReduction, technologies.lpg.cookingTimeReduction);
          const solarTotalHours = calculateTotalHoursSaved(technologies.solar.fuelCollectionReduction, technologies.solar.cookingTimeReduction);

          const icsFuelSavings = baselineFuelCost - icsFuelCost;
          const lpgFuelSavings = baselineFuelCost - lpgFuelCost;
          const solarFuelSavings = baselineFuelCost - solarFuelCost;

          const icsNetBenefit = icsFuelSavings + icsTimeValue - icsCapital;
          const lpgNetBenefit = lpgFuelSavings + lpgTimeValue - lpgCapital;
          const solarNetBenefit = solarFuelSavings + solarTimeValue - solarCapital;

          const icsROI = icsCapital > 0 ? (icsNetBenefit / icsCapital) * 100 : 0;
          const lpgROI = lpgCapital > 0 ? (lpgNetBenefit / lpgCapital) * 100 : 0;
          const solarROI = solarCapital > 0 ? (solarNetBenefit / solarCapital) * 100 : 0;
          
          const icsYearsToRepay = icsNetBenefit > 0 ? technologies.ics.capitalCost / icsNetBenefit : null;
          const lpgYearsToRepay = lpgNetBenefit > 0 ? technologies.lpg.capitalCost / lpgNetBenefit : null;
          const solarYearsToRepay = solarNetBenefit > 0 ? technologies.solar.capitalCost / solarNetBenefit : null;

          // Verdict assessment
          const getVerdict = (netBenefit, roi, yearsToRepay, techName) => {
            if (netBenefit < 0) {
              return {
                status: 'negative',
                icon: '⛔',
                label: 'Negative return',
                summary: `Costs exceed benefits by $${Math.abs(Math.round(netBenefit))}/year`,
                color: '#dc2626',
                bg: '#fee2e2',
                border: '#fecaca'
              };
            }
            if (roi > 100 && yearsToRepay && yearsToRepay < 2) {
              return {
                status: 'excellent',
                icon: '✓✓',
                label: 'Excellent investment',
                summary: `${Math.round(roi)}% ROI, pays back in ${yearsToRepay.toFixed(1)} years`,
                color: '#15803d',
                bg: '#dcfce7',
                border: '#bbf7d0'
              };
            }
            if (roi > 50) {
              return {
                status: 'good',
                icon: '✓',
                label: 'Good investment',
                summary: `${Math.round(roi)}% ROI${yearsToRepay ? `, pays back in ${yearsToRepay.toFixed(1)} years` : ''}`,
                color: '#16a34a',
                bg: '#dcfce7',
                border: '#bbf7d0'
              };
            }
            if (roi > 0) {
              return {
                status: 'marginal',
                icon: '○',
                label: 'Marginal return',
                summary: `${Math.round(roi)}% ROI — positive but modest`,
                color: '#d97706',
                bg: '#fef3c7',
                border: '#fde68a'
              };
            }
            return {
              status: 'breakeven',
              icon: '○',
              label: 'Near break-even',
              summary: 'Benefits roughly equal costs',
              color: '#6b7280',
              bg: '#f3f4f6',
              border: '#e5e7eb'
            };
          };

          const icsVerdict = getVerdict(icsNetBenefit, icsROI, icsYearsToRepay, 'ICS');
          const lpgVerdict = getVerdict(lpgNetBenefit, lpgROI, lpgYearsToRepay, 'LPG');
          const solarVerdict = getVerdict(solarNetBenefit, solarROI, solarYearsToRepay, 'Solar');

          // Simple waterfall chart
          const WaterfallChart = ({ fuelSavings, timeValue, capitalCost, netBenefit }) => {
            const values = [fuelSavings, timeValue, netBenefit];
            const maxVal = Math.max(...values.map(v => Math.abs(v)), capitalCost, 1) * 1.2;
            
            const chartHeight = 80;
            const zeroLine = chartHeight / 2;
            const scale = (chartHeight / 2) / maxVal;
            const barWidth = 50;
            const gap = 14;

            const renderBar = (val, barColor, labelText, xPos, barLabel) => {
              const height = Math.max(Math.abs(val * scale), 2);
              const top = val >= 0 ? zeroLine - height : zeroLine;
              
              return (
                <div style={{ position: 'absolute', left: `${xPos}px` }}>
                  <div style={{ 
                    width: `${barWidth}px`, height: `${height}px`, position: 'absolute', top: `${top}px`,
                    background: barColor, borderRadius: '3px'
                  }}>
                    <div style={{ 
                      color: height > 16 ? 'white' : barColor, fontSize: '11px', fontWeight: '700',
                      textAlign: 'center', position: height > 16 ? 'relative' : 'absolute',
                      top: height > 16 ? '2px' : (val >= 0 ? '-15px' : `${height + 2}px`), width: '100%'
                    }}>{labelText}</div>
                  </div>
                  <div style={{ fontSize: '11px', textAlign: 'center', width: `${barWidth}px`, position: 'absolute', top: `${chartHeight + 4}px`, color: '#6b7280', fontWeight: '500' }}>{barLabel}</div>
                </div>
              );
            };
            
            return (
              <div style={{ display: 'flex', justifyContent: 'center' }}>
                <div style={{ position: 'relative', width: `${barWidth * 4 + gap * 3}px`, height: `${chartHeight + 22}px` }}>
                  <div style={{ position: 'absolute', width: '100%', borderTop: '1px solid #9ca3af', top: `${zeroLine}px` }} />
                  {renderBar(-capitalCost, '#f97316', `-$${Math.round(capitalCost)}`, 0, 'Capital')}
                  {renderBar(fuelSavings, fuelSavings >= 0 ? '#3b82f6' : '#ef4444', `${fuelSavings >= 0 ? '+' : ''}$${Math.round(fuelSavings)}`, barWidth + gap, 'Fuel')}
                  {renderBar(timeValue, '#22c55e', `+$${Math.round(timeValue)}`, (barWidth + gap) * 2, 'Time')}
                  {renderBar(netBenefit, netBenefit >= 0 ? '#15803d' : '#dc2626', `${netBenefit >= 0 ? '+' : ''}$${Math.round(netBenefit)}`, (barWidth + gap) * 3, 'Net')}
                </div>
              </div>
            );
          };

          const SliderControl = ({ label, value, onChange, min, max, step = 1, unit = "", helpText = "", prefix = "" }) => {
            const sliderRef = useRef(null);
            
            useEffect(() => {
              if (sliderRef.current) {
                const percentage = ((value - min) / (max - min)) * 100;
                sliderRef.current.style.background = `linear-gradient(to right, #1e1e1e 0%, #1e1e1e ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
              }
            }, [value, min, max]);
            
            return (
              <div style={{ marginBottom: '16px' }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '6px' }}>
                  <label style={{ fontSize: '14px', fontWeight: '500', color: '#374151' }}>{label}</label>
                  <span style={{ fontSize: '14px', fontWeight: '600', color: '#111827' }}>{prefix}{value}{unit}</span>
                </div>
                {helpText && <div style={{ fontSize: '13px', color: '#6b7280', marginBottom: '6px' }}>{helpText}</div>}
                <input 
                  ref={sliderRef}
                  type="range" 
                  min={min} 
                  max={max} 
                  step={step} 
                  value={value} 
                  onChange={(e) => onChange(parseFloat(e.target.value))} 
                />
              </div>
            );
          };
          
          const getLabel = (tech) => {
            if (stacking === 0) return `100% ${tech}`;
            if (stacking === 100) return `0% ${tech}`;
            return `${100 - stacking}% ${tech}`;
          };

          // Outcome Card Component
          const OutcomeCard = ({ tech, techKey, financing, fuelSavings, timeValue, totalHours, capital, netBenefit, roi, yearsToRepay, verdict }) => {
            const colors = {
              ics: '#3b82f6',
              lpg: '#f97316', 
              solar: '#8b5cf6'
            };
            const color = colors[techKey];
            
            return (
              <div style={{ padding: '18px', background: 'white', border: `3px solid ${color}`, borderRadius: '10px' }}>
                {/* Header */}
                <div style={{ marginBottom: '14px', paddingBottom: '12px', borderBottom: `2px solid ${color}` }}>
                  <div style={{ fontWeight: '700', fontSize: '17px', color: '#1f2937', marginBottom: '4px' }}>{tech.name}</div>
                  <div style={{ fontSize: '13px', color: '#6b7280' }}>{tech.description}</div>
                </div>

                {/* Verdict */}
                <div style={{ padding: '12px', background: verdict.bg, border: `2px solid ${verdict.border}`, borderRadius: '8px', marginBottom: '14px', textAlign: 'center' }}>
                  <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '8px', fontSize: '16px', fontWeight: '700', color: verdict.color, marginBottom: '4px' }}>
                    <span>{verdict.icon}</span><span>{verdict.label}</span>
                  </div>
                  <div style={{ fontSize: '13px', color: verdict.color }}>{verdict.summary}</div>
                </div>

                {/* Key metrics */}
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '10px', marginBottom: '14px' }}>
                  <div style={{ background: '#f9fafb', padding: '10px', borderRadius: '8px', textAlign: 'center' }}>
                    <div style={{ fontSize: '12px', color: '#6b7280', marginBottom: '4px' }}>Net annual benefit</div>
                    <div style={{ fontSize: '22px', fontWeight: '700', color: netBenefit >= 0 ? '#15803d' : '#dc2626' }}>
                      {netBenefit >= 0 ? '+' : ''}${Math.round(netBenefit)}
                    </div>
                  </div>
                  <div style={{ background: '#f9fafb', padding: '10px', borderRadius: '8px', textAlign: 'center' }}>
                    <div style={{ fontSize: '12px', color: '#6b7280', marginBottom: '4px' }}>ROI</div>
                    <div style={{ fontSize: '22px', fontWeight: '700', color: roi >= 0 ? '#15803d' : '#dc2626' }}>
                      {Math.round(roi)}%
                    </div>
                  </div>
                </div>

                {/* Waterfall */}
                <div style={{ marginBottom: '14px', padding: '12px', background: '#f9fafb', borderRadius: '8px' }}>
                  <div style={{ fontSize: '12px', color: '#6b7280', textAlign: 'center', marginBottom: '6px' }}>Annual economics breakdown</div>
                  <WaterfallChart fuelSavings={fuelSavings} timeValue={timeValue} capitalCost={capital} netBenefit={netBenefit} />
                </div>

                {/* Details */}
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '10px' }}>
                  <div style={{ fontSize: '13px', padding: '12px', background: '#f0fdf4', borderRadius: '8px' }}>
                    <div style={{ fontWeight: '600', color: '#166534', marginBottom: '6px' }}>Annual benefits</div>
                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '3px' }}>
                      <span>Fuel savings:</span><span style={{ fontWeight: '500', color: fuelSavings >= 0 ? '#166534' : '#dc2626' }}>{fuelSavings >= 0 ? '+' : ''}${Math.round(fuelSavings)}</span>
                    </div>
                    <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                      <span>Time value:</span><span style={{ fontWeight: '500', color: '#166534' }}>+${Math.round(timeValue)}</span>
                    </div>
                  </div>
                  <div style={{ fontSize: '13px', padding: '12px', background: '#fef2f2', borderRadius: '8px' }}>
                    <div style={{ fontWeight: '600', color: '#991b1b', marginBottom: '6px' }}>Annual costs</div>
                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '3px' }}>
                      <span>Capital cost:</span><span style={{ fontWeight: '500' }}>${Math.round(capital)}</span>
                    </div>
                    <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                      <span>Total paid:</span><span style={{ fontWeight: '500' }}>${Math.round(financing.totalCost)}</span>
                    </div>
                  </div>
                </div>

                {/* Time and payback */}
                <div style={{ marginTop: '12px', padding: '10px', background: '#f9fafb', borderRadius: '6px', fontSize: '13px', color: '#4b5563' }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '4px' }}>
                    <span>Hours saved per year:</span>
                    <span style={{ fontWeight: '600' }}>{Math.round(totalHours)} hrs</span>
                  </div>
                  {yearsToRepay && (
                    <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                      <span>Payback period:</span>
                      <span style={{ fontWeight: '600', color: '#15803d' }}>{yearsToRepay.toFixed(1)} years</span>
                    </div>
                  )}
                </div>
              </div>
            );
          };

          return (
            <div style={{ maxWidth: '1200px', margin: '0 auto', padding: '24px', background: 'white' }}>
              <h1 style={{ fontSize: '24px', fontWeight: 'bold', marginBottom: '20px' }}>Clean cooking economic impact model</h1>
              
              <div style={{ padding: '16px', background: '#f0f9ff', border: '1px solid #bae6fd', borderRadius: '8px', marginBottom: '20px', fontSize: '15px', color: '#1e1e1e', lineHeight: '1.6' }}>
                <p style={{ marginBottom: '10px' }}>
                  <strong>What this model does:</strong> Estimates the annual economic return of clean cooking technologies for low-income households. It compares fuel costs, time savings, and capital costs to calculate net benefit, ROI, and payback period.
                </p>
                <p>
                  <strong>How to use it:</strong> Set baseline fuel costs and time burdens to reflect current household conditions. Choose a payment method and adjust financing terms. The "stove stacking" slider accounts for continued use of traditional stoves alongside modern alternatives.
                </p>
              </div>

              {/* Technology Costs */}
              <div style={{ padding: '20px', background: '#f9fafb', border: '1px solid #e5e7eb', borderRadius: '8px', marginBottom: '20px' }}>
                <h3 style={{ fontSize: '16px', fontWeight: '600', marginBottom: '16px' }}>Technology costs</h3>
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '20px' }}>
                  <div>
                    <div style={{ fontWeight: '600', marginBottom: '6px', color: '#1e1e1e', fontSize: '15px' }}>Improved Cookstoves (ICS)</div>
                    <div style={{ color: '#4b5563', marginBottom: '12px', lineHeight: '1.5', fontSize: '13px' }}>{technologies.ics.description}</div>
                    <SliderControl 
                      label="Capital cost" 
                      value={icsCapitalBase} 
                      onChange={setIcsCapitalBase} 
                      min={15} max={40} step={1} 
                      unit=" USD"
                      helpText="Lifespan: 5 years"
                    />
                  </div>
                  <div>
                    <div style={{ fontWeight: '600', marginBottom: '6px', color: '#1e1e1e', fontSize: '15px' }}>LPG</div>
                    <div style={{ color: '#4b5563', marginBottom: '12px', lineHeight: '1.5', fontSize: '13px' }}>{technologies.lpg.description}</div>
                    <SliderControl 
                      label="Capital cost" 
                      value={lpgCapitalBase} 
                      onChange={setLpgCapitalBase} 
                      min={30} max={80} step={1} 
                      unit=" USD"
                      helpText="Lifespan: 10 years"
                    />
                    <SliderControl 
                      label="Annual LPG fuel cost" 
                      value={lpgAnnualFuelCost} 
                      onChange={setLpgAnnualFuelCost} 
                      min={40} max={150} step={5} 
                      unit=" USD/yr"
                      helpText="Varies by location: Kenya ~$70, Uganda ~$90"
                    />
                  </div>
                  <div>
                    <div style={{ fontWeight: '600', marginBottom: '6px', color: '#1e1e1e', fontSize: '15px' }}>Solar E-Cooking</div>
                    <div style={{ color: '#4b5563', marginBottom: '12px', lineHeight: '1.5', fontSize: '13px' }}>{technologies.solar.description}</div>
                    <SliderControl 
                      label="Capital cost" 
                      value={solarCapitalBase} 
                      onChange={setSolarCapitalBase} 
                      min={400} max={900} step={10} 
                      unit=" USD"
                      helpText="Lifespan: 7 years"
                    />
                  </div>
                </div>
              </div>

              {/* Payment Method and Financing - Purple background */}
              <div style={{ padding: '20px', background: '#faf5ff', border: '2px solid #e9d5ff', borderRadius: '8px', marginBottom: '20px' }}>
                <h3 style={{ fontSize: '16px', fontWeight: '600', marginBottom: '16px', color: '#6b21a8' }}>Payment method and financing</h3>
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
                  <div>
                    <div style={{ display: 'flex', gap: '10px', marginBottom: '16px' }}>
                      <button 
                        onClick={() => setPaymentMethod('upfront')} 
                        style={{ 
                          flex: 1, padding: '10px 14px', fontSize: '14px', borderRadius: '6px', cursor: 'pointer',
                          border: '2px solid #1e1e1e',
                          background: paymentMethod === 'upfront' ? '#1e1e1e' : 'white',
                          color: paymentMethod === 'upfront' ? 'white' : '#374151',
                          fontWeight: '500'
                        }}
                      >
                        Cash upfront
                      </button>
                      <button 
                        onClick={() => setPaymentMethod('financing')} 
                        style={{ 
                          flex: 1, padding: '10px 14px', fontSize: '14px', borderRadius: '6px', cursor: 'pointer',
                          border: '2px solid #1e1e1e',
                          background: paymentMethod === 'financing' ? '#1e1e1e' : 'white',
                          color: paymentMethod === 'financing' ? 'white' : '#374151',
                          fontWeight: '500'
                        }}
                      >
                        Consumer loan
                      </button>
                      <button 
                        onClick={() => setPaymentMethod('payg')} 
                        style={{ 
                          flex: 1, padding: '10px 14px', fontSize: '14px', borderRadius: '6px', cursor: 'pointer',
                          border: '2px solid #1e1e1e',
                          background: paymentMethod === 'payg' ? '#1e1e1e' : 'white',
                          color: paymentMethod === 'payg' ? 'white' : '#374151',
                          fontWeight: '500'
                        }}
                      >
                        PAYG (lease-to-own)
                      </button>
                    </div>

                    {paymentMethod === 'financing' && (
                      <div style={{ padding: '16px', background: 'white', borderRadius: '6px', border: '1px solid #e5e7eb' }}>
                        <SliderControl label="Deposit requirement" value={depositPercent} onChange={setDepositPercent} min={0} max={50} step={5} unit="%" helpText="Most MFIs require 10-30% upfront" />
                        <SliderControl label="Loan term" value={loanTermYears} onChange={setLoanTermYears} min={0.5} max={3} step={0.5} unit=" years" helpText="Cookstove loans typically 1-2 years" />
                        <SliderControl label="Annual interest rate (APR)" value={annualInterestRate} onChange={setAnnualInterestRate} min={15} max={50} step={1} unit="%" helpText="Rural MFI rates: 20-35% typical" />
                      </div>
                    )}

                    {paymentMethod === 'payg' && (
                      <div style={{ padding: '16px', background: 'white', borderRadius: '6px', border: '1px solid #e5e7eb' }}>
                        <SliderControl label="Lease-to-own term" value={paygTermYears} onChange={setPaygTermYears} min={1} max={4} step={0.5} unit=" years" helpText="Period until household owns asset" />
                        <SliderControl label="Total premium over cash price" value={paygPremiumPercent} onChange={setPaygPremiumPercent} min={30} max={100} step={5} unit="%" helpText="PAYG cookstoves typically 50-80% premium" />
                        <div style={{ fontSize: '13px', color: '#6b7280', marginTop: '8px' }}>
                          No deposit required. Household owns asset after completing all payments.
                        </div>
                      </div>
                    )}

                    {paymentMethod === 'upfront' && (
                      <div style={{ padding: '16px', background: 'white', borderRadius: '6px', border: '1px solid #e5e7eb', fontSize: '14px', color: '#4b5563' }}>
                        <p>Full cash payment upfront. Lowest total cost, but requires access to lump sum capital.</p>
                        <p style={{ marginTop: '10px', fontWeight: '500' }}>Best ROI, but highest access barrier for low-income households.</p>
                      </div>
                    )}
                    
                    <div style={{ marginTop: '16px' }}>
                      <SliderControl label="Monthly household income" value={monthlyHouseholdIncome} onChange={setMonthlyHouseholdIncome} min={30} max={600} step={10} unit=" USD" helpText="Used for affordability analysis" />
                    </div>
                  </div>

                  <div>
                    <div style={{ fontSize: '14px', fontWeight: '600', marginBottom: '12px', color: '#6b21a8' }}>Financing summary by technology</div>
                    <div style={{ padding: '16px', background: 'white', borderRadius: '6px', border: '1px solid #e5e7eb', fontSize: '14px' }}>
                      <div style={{ marginBottom: '14px' }}>
                        <div style={{ fontWeight: '600', color: '#1e1e1e' }}>ICS</div>
                        <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                          <span>Total cost:</span>
                          <span style={{ fontWeight: '500' }}>${Math.round(icsTotalCapital)}</span>
                        </div>
                        {paymentMethod !== 'upfront' && (
                          <>
                            <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                              <span>Monthly payment:</span>
                              <span style={{ fontWeight: '500' }}>${icsFinancing.monthlyPayment.toFixed(2)}</span>
                            </div>
                            {paymentMethod === 'financing' && (
                              <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                                <span>Deposit:</span>
                                <span style={{ fontWeight: '500' }}>${Math.round(icsFinancing.depositRequired)}</span>
                              </div>
                            )}
                          </>
                        )}
                      </div>
                      
                      <div style={{ marginBottom: '14px', paddingTop: '10px', borderTop: '1px solid #e5e7eb' }}>
                        <div style={{ fontWeight: '600', color: '#1e1e1e' }}>LPG</div>
                        <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                          <span>Total cost:</span>
                          <span style={{ fontWeight: '500' }}>${Math.round(lpgTotalCapital)}</span>
                        </div>
                        {paymentMethod !== 'upfront' && (
                          <>
                            <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                              <span>Monthly payment:</span>
                              <span style={{ fontWeight: '500' }}>${lpgFinancing.monthlyPayment.toFixed(2)}</span>
                            </div>
                            {paymentMethod === 'financing' && (
                              <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                                <span>Deposit:</span>
                                <span style={{ fontWeight: '500' }}>${Math.round(lpgFinancing.depositRequired)}</span>
                              </div>
                            )}
                          </>
                        )}
                      </div>
                      
                      <div style={{ paddingTop: '10px', borderTop: '1px solid #e5e7eb' }}>
                        <div style={{ fontWeight: '600', color: '#1e1e1e' }}>Solar</div>
                        <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                          <span>Total cost:</span>
                          <span style={{ fontWeight: '500' }}>${Math.round(solarTotalCapital)}</span>
                        </div>
                        {paymentMethod !== 'upfront' && (
                          <>
                            <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                              <span>Monthly payment:</span>
                              <span style={{ fontWeight: '500' }}>${solarFinancing.monthlyPayment.toFixed(2)}</span>
                            </div>
                            {paymentMethod === 'financing' && (
                              <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                                <span>Deposit:</span>
                                <span style={{ fontWeight: '500' }}>${Math.round(solarFinancing.depositRequired)}</span>
                              </div>
                            )}
                          </>
                        )}
                      </div>
                    </div>

                    {/* Affordability alerts */}
                    {allAffordabilityIssues.length > 0 && (
                      <div style={{ marginTop: '14px' }}>
                        {allAffordabilityIssues.map((issue, idx) => (
                          <div key={idx} style={{ 
                            padding: '12px', 
                            background: issue.severity === 'error' ? '#fee2e2' : '#fef3c7', 
                            border: `2px solid ${issue.severity === 'error' ? '#fecaca' : '#fde68a'}`, 
                            borderRadius: '6px', 
                            marginBottom: '8px', 
                            fontSize: '13px', 
                            lineHeight: '1.5' 
                          }}>
                            <strong>{issue.severity === 'error' ? '⛔' : '⚠️'}</strong> {issue.message}
                          </div>
                        ))}
                      </div>
                    )}
                    {allAffordabilityIssues.length === 0 && (
                      <div style={{ marginTop: '14px', padding: '12px', background: '#dcfce7', border: '2px solid #bbf7d0', borderRadius: '6px', fontSize: '13px', lineHeight: '1.5' }}>
                        <strong>✓ Affordability check passed:</strong> {paymentMethod === 'upfront' ? 'Upfront costs are within sustainable range relative to household income.' : 'All monthly payments are within sustainable range relative to household income.'}
                      </div>
                    )}
                  </div>
                </div>
              </div>

              {/* Baseline Context */}
              <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px', marginBottom: '20px' }}>
                <div style={{ padding: '18px', background: '#f9fafb', borderRadius: '8px' }}>
                  <h3 style={{ fontSize: '16px', fontWeight: '600', marginBottom: '14px' }}>Baseline context</h3>
                  <SliderControl label="Annual baseline fuel cost" value={baselineFuelCost} onChange={setBaselineFuelCost} min={0} max={300} step={5} unit=" USD/yr" helpText="Traditional fuels (wood, charcoal) may be gathered free, purchased, or both" />
                  <SliderControl label="Daily fuel collection time" value={baselineFuelCollection} onChange={setBaselineFuelCollection} min={0} max={5} step={0.1} unit=" hrs" helpText="Time women spend gathering firewood/fuel daily" />
                  <SliderControl label="Daily cooking time" value={baselineCookingTime} onChange={setBaselineCookingTime} min={2} max={10} step={0.1} unit=" hrs" helpText="Includes meal prep and tending traditional stove" />
                </div>

                <div style={{ padding: '18px', background: '#f9fafb', borderRadius: '8px' }}>
                  <h3 style={{ fontSize: '16px', fontWeight: '600', marginBottom: '14px' }}>Time value and adoption</h3>
                  <SliderControl label="Wage rate" value={wageRate} onChange={setWageRate} min={0.1} max={2} step={0.01} unit=" USD/hr" helpText="Based on local agricultural wage rates" />
                  <SliderControl label="Time reallocated to paid work" value={timeReallocationPct} onChange={setTimeReallocationPct} min={0} max={100} step={5} unit="%" helpText="Portion of time saved that generates income" />
                  <SliderControl label="Stove stacking (traditional use)" value={stacking} onChange={setStacking} min={0} max={100} step={5} unit="%" helpText="Households often continue using traditional stoves alongside modern ones" />
                </div>
              </div>

              {/* Time saved summary */}
              <div style={{ padding: '16px', background: '#eff6ff', borderLeft: '4px solid #1e1e1e', marginBottom: '20px' }}>
                <h3 style={{ fontSize: '16px', fontWeight: '600', marginBottom: '12px' }}>Time saved by women (per year, at current stacking level)</h3>
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '20px', fontSize: '14px' }}>
                  <div>
                    <div style={{ fontWeight: '600', marginBottom: '4px' }}>ICS: {Math.round(icsTotalHours)} hours/year</div>
                    <div style={{ color: '#4b5563', fontSize: '13px' }}>Collection: -{(technologies.ics.fuelCollectionReduction * 100).toFixed(0)}% | Cooking: -{(technologies.ics.cookingTimeReduction * 100).toFixed(0)}%</div>
                  </div>
                  <div>
                    <div style={{ fontWeight: '600', marginBottom: '4px' }}>LPG: {Math.round(lpgTotalHours)} hours/year</div>
                    <div style={{ color: '#4b5563', fontSize: '13px' }}>Collection: -{(technologies.lpg.fuelCollectionReduction * 100).toFixed(0)}% | Cooking: -{(technologies.lpg.cookingTimeReduction * 100).toFixed(0)}%</div>
                  </div>
                  <div>
                    <div style={{ fontWeight: '600', marginBottom: '4px' }}>Solar: {Math.round(solarTotalHours)} hours/year</div>
                    <div style={{ color: '#4b5563', fontSize: '13px' }}>Collection: -{(technologies.solar.fuelCollectionReduction * 100).toFixed(0)}% | Cooking: -{(technologies.solar.cookingTimeReduction * 100).toFixed(0)}%</div>
                  </div>
                </div>
              </div>

              {/* Results - Outcome Cards */}
              <div style={{ marginBottom: '20px' }}>
                <h2 style={{ fontSize: '18px', fontWeight: '600', marginBottom: '14px' }}>Economic comparison: {getLabel("ICS")} | {getLabel("LPG")} | {getLabel("Solar")}</h2>
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '18px' }}>
                  <OutcomeCard 
                    tech={technologies.ics} techKey="ics" financing={icsFinancing}
                    fuelSavings={icsFuelSavings} timeValue={icsTimeValue} totalHours={icsTotalHours}
                    capital={icsCapital} netBenefit={icsNetBenefit} roi={icsROI} yearsToRepay={icsYearsToRepay}
                    verdict={icsVerdict}
                  />
                  <OutcomeCard 
                    tech={technologies.lpg} techKey="lpg" financing={lpgFinancing}
                    fuelSavings={lpgFuelSavings} timeValue={lpgTimeValue} totalHours={lpgTotalHours}
                    capital={lpgCapital} netBenefit={lpgNetBenefit} roi={lpgROI} yearsToRepay={lpgYearsToRepay}
                    verdict={lpgVerdict}
                  />
                  <OutcomeCard 
                    tech={technologies.solar} techKey="solar" financing={solarFinancing}
                    fuelSavings={solarFuelSavings} timeValue={solarTimeValue} totalHours={solarTotalHours}
                    capital={solarCapital} netBenefit={solarNetBenefit} roi={solarROI} yearsToRepay={solarYearsToRepay}
                    verdict={solarVerdict}
                  />
                </div>
              </div>

              {/* Summary boxes */}
              <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px', fontSize: '14px' }}>
                <div style={{ padding: '16px', background: '#fef3c7', border: '1px solid #fbbf24', borderRadius: '8px' }}>
                  <h3 style={{ fontWeight: '600', marginBottom: '10px' }}>Baseline conditions</h3>
                  <div style={{ display: 'flex', flexDirection: 'column', gap: '6px', color: '#374151' }}>
                    <div><strong>Primary fuel:</strong> Biomass (wood, charcoal), traditional 3-stone fire</div>
                    <div><strong>PM2.5 exposure:</strong> 695 μg/m³ (hazardous level, 139x WHO guidelines)</div>
                    <div><strong>Daily time burden:</strong> {baselineFuelCollection.toFixed(1)} hrs collection + {baselineCookingTime.toFixed(1)} hrs cooking</div>
                    <div><strong>Annual fuel expenditure:</strong> ${baselineFuelCost}</div>
                    <div><strong>Monthly household income:</strong> ${monthlyHouseholdIncome}</div>
                  </div>
                </div>

                <div style={{ padding: '16px', background: '#dcfce7', border: '1px solid #22c55e', borderRadius: '8px' }}>
                  <h3 style={{ fontWeight: '600', marginBottom: '10px' }}>Health impact (full adoption, no stacking)</h3>
                  <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '12px', color: '#374151' }}>
                    <div>
                      <div style={{ fontWeight: '600' }}>ICS</div>
                      <div>PM2.5: -{(technologies.ics.pm25Reduction * 100).toFixed(0)}%</div>
                      <div>DALYs: {technologies.ics.dalys}/yr</div>
                    </div>
                    <div>
                      <div style={{ fontWeight: '600' }}>LPG</div>
                      <div>PM2.5: -{(technologies.lpg.pm25Reduction * 100).toFixed(0)}%</div>
                      <div>DALYs: {technologies.lpg.dalys}/yr</div>
                    </div>
                    <div>
                      <div style={{ fontWeight: '600' }}>Solar</div>
                      <div>PM2.5: -{(technologies.solar.pm25Reduction * 100).toFixed(0)}%</div>
                      <div>DALYs: {technologies.solar.dalys}/yr</div>
                    </div>
                  </div>
                </div>
              </div>

              {/* Model notes */}
              <div style={{ marginTop: '20px', padding: '16px', background: '#f3f4f6', borderRadius: '8px', fontSize: '13px', color: '#6b7280', lineHeight: '1.6' }}>
                <strong>Model assumptions:</strong> Equipment lifespans are ICS: 5 years, LPG: 10 years, Solar: 7 years. Financing terms based on rural MFI and PAYG market data from East Africa. Time value only realized when time is reallocated to paid work. Stove stacking reduces all benefits proportionally. LPG economics depend heavily on local fuel prices and supply chain reliability.
              </div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<StoveStackingWidget />);
    </script>
</body>
</html>
